<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${mode == 'create'} ? '글쓰기' : '글 수정'">게시판</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">WebSecurity Demo</a>
    <div>
      <a class="nav-link d-inline-block text-white-50" href="/board">게시판</a>
      <a class="nav-link d-inline-block text-white-50" href="/board/write">글쓰기</a>
    </div>
  </div>
</nav>

<div class="container my-4">

  <div class="mb-3">
    <a href="/board" class="btn btn-outline-secondary btn-sm">&laquo; 목록으로</a>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="h4 mb-3" th:text="${mode == 'create'} ? '글쓰기' : '글 수정'"></h1>

      <!-- 🔹 이미지 업로드 위해 enctype 추가 -->
      <form th:action="${mode == 'create'} ? @{/board} : @{'/board/' + ${post.id} + '/edit'}"
            method="post"
            enctype="multipart/form-data"
            class="row g-3">

        <div class="col-12">
          <label class="form-label">제목</label>
          <input type="text" name="title" class="form-control"
                 th:value="${post.title}" required>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">작성자</label>
          <input type="text" name="writer" class="form-control"
                 th:value="${post.writer}" required>
        </div>

        <div class="col-12">
          <label class="form-label">내용</label>
          <textarea name="content" rows="10" class="form-control"
                    th:text="${post.content}" required></textarea>
        </div>

        <!-- 🔹 이미지 파일 업로드 -->
        <div class="col-12 col-md-6">
          <label class="form-label">이미지 업로드</label>
          <input type="file" name="imageFile" class="form-control" accept="image/*">
          <div class="form-text">
            게시글과 함께 보여줄 이미지를 선택할 수 있습니다.
          </div>
        </div>

        <!-- 기존에 이미지가 있을 경우 미리보기 -->
        <div class="col-12" th:if="${post.imageUrl != null}">
          <label class="form-label">현재 이미지</label><br>
          <img th:src="${post.imageUrl}"
               class="img-fluid border rounded mb-2"
               style="max-width: 250px;">
          <div class="form-text">
            새 이미지를 업로드하면 기존 이미지는 교체됩니다.
          </div>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">비밀번호</label>
          <input type="password" name="password" class="form-control" required>
          <div class="form-text">
            수정·삭제 시 사용할 비밀번호입니다.
          </div>
        </div>

        <div class="col-12 d-flex gap-2">
          <button type="submit" class="btn btn-primary"
                  th:text="${mode == 'create'} ? '등록' : '수정 완료'"></button>
          <a href="/board" class="btn btn-outline-secondary">취소</a>
        </div>
      </form>

      <div th:if="${errorMessage != null}" class="alert alert-danger mt-3" role="alert">
        <span th:text="${errorMessage}"></span>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
