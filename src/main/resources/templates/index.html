<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>이미지 SSRF 데모</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">WebSecurity Demo</a>
    <div>
      <a class="nav-link d-inline-block text-white-50" href="/board">게시판</a>
      <a class="nav-link d-inline-block text-white-50" href="/board/write">글쓰기</a>
    </div>
  </div>
</nav>

<div class="container my-4">

  <div class="row">
    <div class="col-lg-8">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h1 class="card-title h3 mb-3">이미지 SSRF 데모</h1>

          <!-- 1) URL 입력 폼 -->
          <h2 class="h5 mb-3">이미지 URL 입력 (게시판 업로드)</h2>
          <form th:action="@{/upload-url}" method="post" class="row g-2 mb-3">
            <div class="col-12 col-md-9">
              <input type="text" name="url" class="form-control"
                     placeholder="http://example.com/image.png">
            </div>
            <div class="col-12 col-md-3 d-grid">
              <button type="submit" class="btn btn-primary">게시글 등록</button>
            </div>
          </form>

          <!-- 방금 업로드된 이미지 미리보기 -->
          <div th:if="${lastImageUrl}" class="mt-3">
            <h3 class="h6">방금 업로드된 이미지</h3>
            <img th:src="${lastImageUrl}" class="img-fluid border rounded" style="max-width: 300px;"/><br/>
          </div>

          <p th:if="${message}" th:text="${message}" class="text-primary mt-2"></p>
          <p th:if="${errorMessage}" th:text="${errorMessage}" class="text-danger mt-2"></p>

          <!-- 서버가 가져온 응답(이미지) 출력 -->
          <div th:if="${previewImage}" class="mt-4">
            <h3 class="h6">서버가 가져온 응답</h3>
            <p class="small text-muted" th:text="'요청 URL: ' + ${requestedUrl}"></p>
            <img th:src="'data:image/png;base64,' + ${previewImage}"
                 class="img-fluid border rounded" style="max-width:300px;"/><br/>
          </div>
        </div>
      </div>

      <!-- 2) 파일 업로드 -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h2 class="h5 mb-3">파일 업로드</h2>
          <form th:action="@{/upload}" method="post" enctype="multipart/form-data" class="row g-2">
            <div class="col-12 col-md-9">
              <input type="file" name="file" class="form-control"/>
            </div>
            <div class="col-12 col-md-3 d-grid">
              <button type="submit" class="btn btn-secondary">업로드</button>
            </div>
          </form>
          <p th:if="${message}" th:text="${message}" class="mt-2"></p>
        </div>
      </div>
    </div>

    <!-- 오른쪽: 업로드된 이미지 목록 -->
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h5 mb-3">업로드된 이미지들</h2>
          <div th:if="${images != null}">
            <div th:each="img : ${images}" class="mb-3">
              <img th:src="${img}" class="img-fluid border rounded mb-1" style="max-width: 100%;"/><br/>
              <span class="small text-muted" th:text="${img}"></span>
              <hr/>
            </div>
          </div>
          <p th:if="${images == null}" class="text-muted small">아직 업로드된 이미지가 없습니다.</p>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Bootstrap JS (선택) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
